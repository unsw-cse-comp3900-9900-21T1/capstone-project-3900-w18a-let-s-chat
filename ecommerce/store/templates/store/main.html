<!DOCTYPE html>
{% load static %}
<html>
<head>
	<title>Petiverse</title>

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1" />
	<script type="text/javascript">
		var user = '{{request.user}}'
		function getToken(name) {
			var cookieValue = null;
			if (document.cookie && document.cookie !== '') {
				var cookies = document.cookie.split(';');
				for (var i = 0; i < cookies.length; i++) {
					var cookie = cookies[i].trim();
					// Does this cookie string begin with the name we want?
					if (cookie.substring(0, name.length + 1) === (name + '=')) {
						cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						break;
					}
				}
			}
			return cookieValue;
		}
		var csrftoken = getToken('csrftoken')		
	</script>

    <!--Referece: https://getbootstrap.com/-->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>
	<link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}">

	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<style>
		img:hover {
    		cursor: pointer;
		}
	</style>
</head>
<body>

	<nav class="navbar sticky-top navbar-expand-lg navbar-light bg-light">
	<!-- Brand name -->
	  <a class="navbar-brand" href="{% url 'store' %}">Petiverse</a>
	  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
	    <span class="navbar-toggler-icon"></span>
	  </button>

	  <div class="collapse navbar-collapse" id="navbarSupportedContent">

		<!-- Hello message -->
	    <ul class="navbar-nav mr-auto">
	      <li class="nav-item active">
			{% if request.user.is_authenticated %}
				<span class="hello-msg navbar-text">Hello, {{request.user.customer.nickname}}</span>
			{% endif %}
	      </li>
	 
	    </ul>

			<!-- Search Bar -->
	        <form action="{% url 'search_result' %}" method="get">
	        	<input class="search_bar"  name = "q" type="text" placeholder="Search...", style="border-radius:3px !important; border:none; min-height:32px !important; padding-left:5px;">
	        	<!-- <input type="submit" value="Search"> -->
	        </form>

			<!-- Login / logout buttons -->
			{% if not request.user.is_authenticated %}
	     		<a href="/login" class="btn btn-secondary ">Login</a>
				<a href="/signup" class="btn btn-secondary">Sign Up</a>
			{% endif %}

			<!-- Cart icon -->
	     	<a href="{% url 'cart' %}">
	    		<i id="cart-icon" class="bi-cart cart-icon"></i>
	    	</a>
	    	<p id="cart-total">{{cartItems}}</p>
			
			<!-- Dropdown menu -->
			{% if request.user.is_authenticated %}
				<div class="dropdown">
					<i class="bi-person-circle" id="user-icon" onclick="myFunction()" ></i>
					<div id="myDropdown" class="dropdown-content">
						<a href="/new_product"><i class="bi-plus-square dropdown-icon"></i>New listing</a>
						<a href="/my_listings"><i class="bi-card-checklist dropdown-icon"></i>Manage my listings</a>
						<a href="/purchase_history"> <i class="bi-clock-history dropdown-icon"></i>Purchase history</a>
						<a href="/user_profile"><i class="bi-person dropdown-icon"></i>User profile</a>
						<a href="/logout"><i class="bi-power dropdown-icon"></i>Log out</a>
					</div>
				</div>
			{% endif %}
	  </div>
	</nav>

     <div class="container">
            <br>
            {% block content %}


            {% endblock content %}
         </div>


    <!--Below 3 lines of code referece: https://getbootstrap.com/-->

	<!-- <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script> -->
	<!-- The JQuery version above came from the bootstrap reference but does not contain ajax as it is the "slim" version. The version below is the full version containing ajax. -->
	<script src="{% static 'javascript/jquery.js' %}"></script>

	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>

	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
	
	<!-- javascript path here -->
	<script type="text/javascript" src="{% static 'javascript/cart.js' %}"></script>


	<script>
	/* When the user clicks on the button, 
	toggle between hiding and showing the dropdown content */
	function myFunction() {
		document.getElementById("myDropdown").classList.toggle("show");
	}

	// Close the dropdown if the user clicks outside of it
	window.onclick = function(event) {
		if (!event.target.matches('#user-icon')) {
			var dropdowns = document.getElementsByClassName("dropdown-content");
			var i;
			for (i = 0; i < dropdowns.length; i++) {
				var openDropdown = dropdowns[i];
				if (openDropdown.classList.contains('show')) {
					openDropdown.classList.remove('show');
				}
			}
		}
	}
	</script>
    <script type="text/javascript">
      (function(d, m){
          var kommunicateSettings = 
              {"appId":"232096f64f61d669fec1cc191fadff44e","popupWidget":true,"automaticChatOpenOnNavigation":true};
          var s = document.createElement("script"); s.type = "text/javascript"; s.async = true;
          s.src = "https://widget.kommunicate.io/v2/kommunicate.app";
          var h = document.getElementsByTagName("head")[0]; h.appendChild(s);
          window.kommunicate = m; m._globals = kommunicateSettings;
      })(document, window.kommunicate || {});
  /* NOTE: Use webserver to view HTML files as the real-time update will not work if you directly open the HTML file in the browser. */
  </script>

</body>
</html>
